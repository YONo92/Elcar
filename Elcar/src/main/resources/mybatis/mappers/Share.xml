<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.elcar.share.ShareDAO">

	<insert id="insertShare" parameterType="Share">
 	<![CDATA[
		insert into talge(sincheng_id,date,person,request,start_long,start_lat,goal_long,goal_lat,status,start_name,goal_name) 
		values(#{sincheng_id},#{date},#{person},#{request},#{start_long},#{start_lat},#{goal_long},#{goal_lat},#{status},#{start_name},#{goal_name})
	]]>
	</insert>
	<select id="selectShareList" resultType="share">
      <![CDATA[
         SELECT *,
		(6371*acos(cos(radians(#{lat}))*cos(radians(start_lat))*cos(radians(start_long)
		-radians(#{lng}))+sin(radians(#{lat}))*sin(radians(start_lat))))
		AS distance 
		FROM talge 
		having date > now() 
		and distance <= 10 
		ORDER BY distance 
		LIMIT 0,1000;
      ]]>
	</select>

	<select id="shareListCount" resultType="int">
      <![CDATA[
         select count(*) from 
		(SELECT *,
		(6371*acos(cos(radians(#{lat}))*cos(radians(start_lat))*cos(radians(start_long)
		-radians(#{lng}))+sin(radians(#{lat}))*sin(radians(start_lat))))
		AS distance 
		FROM talge 
		having date > now() 
		and distance <= 10 
		ORDER BY distance 
		LIMIT 0,1000) t;
      ]]>
      
	</select>

</mapper>